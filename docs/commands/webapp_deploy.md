---
hide:
- toc
---
# WebApp Deploy

`babylon webapp deploy` will create a static webapp and configure it with the sample webapp source code.

This includes:

  - Creating and configuring an Azure Static WebApp resource
  - Creating and configuring an Azure Active Directory App Registration
  - Creating an Application Insights
  - Configuring the Sample WebApp source code
  - Adding access to the PowerBI Workspace

???+ warning "Requirements"
    This macro requires a github access token set in `.secrets.yaml.encrypt`, please generate github access token using classic tokens, and add it to the file using the following command:
    ```bash
    `babylon config set-variable secrets github.token [github_pat_token]`
    ```
    Github access tokens can be generated on the following page [Github access Tokens](https://github.com/settings/tokens)

  
???+ abstract "Command"
    ```bash
    babylon powerbi deploy-workspace --help
    # Usage: babylon webapp deploy [OPTIONS]
    #
    #   Macro command that deploys a new webapp
    #
    # Options:
    #   --enable-powerbi  Enable PowerBI configuration
    #   -h, --help                      Show this message and exit.
    ```

???+ warning "Requirements"
    This macro requires a github repository with the destination branch already created
    
    1. [import a project](https://github.com/new/import) in Github
    2. Choose to clone the project azure-sample-webapp by setting the repository URL to https://github.com/Cosmo-Tech/azure-sample-webapp
    3. clone & configure
    ```bash
      git clone git@github.com:<GITHUB_REPOSITORY_URL>  # Replace by the URL of your own repository (e.g. Cosmo-Tech/azure-supplychain-webapp.git)
      cd <YOUR REPOSITORY_NAME> # Replace by the name of the folder created by "git clone"
      git remote add upstream git@github.com:Cosmo-Tech/azure-sample-webapp.git
      git remote set-url upstream --push "NO"
      git fetch upstream
    ```

!!! info "DNS Record"
    DNS Record creation is intently not supported by Babylon.  
    If you want a DNS of the form `[deployment_name].app.cosmotech.com` you should

    1. Create a new DNS record for the webapp domain name:
      > Azure Portal > DNS Zones > app.cosmotech.com > "+ Record set"

    2. Configure the DNS as below:
        ```yaml
        name: <DOMAIN_NAME_PREFIX> (the prefix of the domain name that will be used in front of app.cosmotech.com; e.g.  lorealppc.dev for lorealppc.dev.app.cosmotech)  
        type: CNAME  
        alias record set: No  
        TTL: 5 minutes  
        alias: <AZURE_STATIC_APPS_DOMAIN> (automatically generated when you created the static web app; e.g icy-island-123456789.0.azurestaticapps.net)  
        ```
        ![Screenshot of creating a DNS record](../assets/webapp_prequisite_2.png)

???+ note "Options"
    === "`--enable-powerbi`"
        This option will enable powerbi configuration steps **4**,**9**,**10** and **11**.
   
???+ abstract "Steps"
    Please follow the links to each command to check if all configuration variables are set.

    1. Creation of a Static WebApp resource `Azure[deployment_name]WebApp`  
    [babylon azure staticwebapp create](https://cosmo-tech.github.io/Babylon/latest/cli/#create_10)
    2. Adding a DNS domain to the Static WebApp (Optional)  
    [babylon azure staticwebapp custom-domain create](https://cosmo-tech.github.io/Babylon/latest/cli/#create_11)  
    3. Creation of an Active Directory App Registration `Azure[deployment_name]WebApp`  
    [babylon azure ad app create](https://cosmo-tech.github.io/Babylon/latest/cli/#create_5)  
    4. Adding the App Registration to the PowerBI Active Directory group (Optional)  
    [babylon azure ad group member add](https://cosmo-tech.github.io/Babylon/latest/cli/#add)  
    5. Creation of the Application Insight ressource (Optional)  
    [babylon azure appinsight create](https://cosmo-tech.github.io/Babylon/latest/cli/#create_8)  
    6. Download the WebApp source code from github  
    [babylon webapp download](https://cosmo-tech.github.io/Babylon/latest/cli/#download_2)  
    7. Update the workflow file generated by Azure to read a `config.json` file and set environment variables  
    [babylon webapp update-workflow](https://cosmo-tech.github.io/Babylon/latest/cli/#update-workflow)  
    8. Export data from Babylon configuration in a `config.json` file to configure the WebApp  
    [babylon webapp export-config](https://cosmo-tech.github.io/Babylon/latest/cli/#export-config)      
    9. Add/Commit/Push the `config.json` and the workflow files to the github repository  
    [babylon webapp upload-file](https://cosmo-tech.github.io/Babylon/latest/cli/#upload-file)  
    10. Create a secret to grant access to PowerBI (Optional)   
    [babylon azure ad app password create](https://cosmo-tech.github.io/Babylon/latest/cli/#create_6)  
    11. Add the App Registration to the PowerBI workspace (Optional)  
    [babylon powerbi workspace user add](https://cosmo-tech.github.io/Babylon/latest/cli/#add_2)
    12. Update the StaticWebApp settings to link with the PowerBI workspace  
    [babylon azure staticwebapp app-settings update](https://cosmo-tech.github.io/Babylon/latest/cli/#update_5)
