{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Discover Babylon","text":"<p>Welcome to the End User Documentation of Babylon</p> <p>This documentation will guide you on your learning adventure with Babylon.</p>"},{"location":"#what-is-babylon","title":"What is Babylon ?","text":"<p>Babylon is a powerful <code>CLI[^1]</code> designed to simplify how users interact with the Cosmo Tech AI Simulation Platform. Babylon is built for all users who want to manage their projects workspace in a simple, streamlined fashion without switching between multiple complex tools.</p> <p>Instead of requiring the user to learn how to use numerous software to interact with the systems, Babylon allows you to learn a single format.</p>"},{"location":"#why-babylon","title":"Why Babylon ?","text":"<p>Babylon was developed to help users getting around the difficulty of juggling around with multiple softwares to interact with the multiple systems composing the Cosmo Tech AI Simulation Platform.</p> <p>By using Babylon you only need one single software to work on your multiple needs.</p> <p>The team behind Babylon is closely tied to the one working on the Cosmo Tech AI Simulation Platform, and new features of the platform can quickly be added to Babylon allowing users to get fast access to the newest content.</p>"},{"location":"#still-not-convinced","title":"\ud83e\udd14 Still not convinced ?","text":"<p>Why should you care</p> <p>Babylon is more than a CLI it's a framework It not only gives you access to low-level commands (direct interaction with a single system), but also provides high-level commands that allow automation of entire processes.  </p> <p>This reduces the risk of human errors. This saves time when dealing with complex workflows.  </p>"},{"location":"#macro-commands","title":"\ud83d\udd11 Macro Commands","text":"<p>Automation made simple</p> <p>Babylon introduces <code>Macro Commands[^2]</code>: combinations of low-level commands bundled into one simple instruction.  </p> <p>\ud83d\udc49 With Macro Commands, you can automate complex operations in a safer and faster way.  </p> <ol> <li> <p>Command Line Interface (CLI): A software used in a terminal console, allowing to run commands.\u00a0\u21a9</p> </li> <li> <p>Macro Commands: A combination of low level commands allowing to do complex operation in a high level manner.\u00a0\u21a9</p> </li> </ol>"},{"location":"Licence/","title":"License","text":"<p>MIT License</p> <p>Copyright \u00a9 2021\u20132025 Cosmo Tech</p> <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the \"Software\"), to deal in the Software without restriction,including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p> <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p> <p>\u26a0\ufe0f Disclaimer  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE</p>"},{"location":"Examples/","title":"Examples","text":"<p>A collection of examples to get started with Babylon v5 for deploying and updating workspaces</p> <p> Example: Deploying a Cosmo Tech Workspace</p> <p>This guide provides an example on how to deploy a workspace using Babylon v5.</p> <p> Deploy</p> <p> Example: Updating a Cosmo Tech Workspace</p> <p>This guide explains how to update a Cosmo Tech workspace.</p> <p> Udpate</p>"},{"location":"Examples/Example_Deploy_CosmoTech_workspace/","title":"Deploy Cosmo Tech workspace","text":"<p>Make sure your Python virtual environment is set up correctly see \ud83d\udc49 Install.</p> <p>After that, you need to create a test folder, for example:</p> <pre><code>mkdir test-babylon &amp;&amp; cd test-babylon\n</code></pre>"},{"location":"Examples/Example_Deploy_CosmoTech_workspace/#set-kubernetes-context","title":"Set Kubernetes Context","text":"<p>Check your current Kubernetes context and switch to the correct one:</p> <p>Example</p> <p><pre><code>&gt; kubectl config current-context\ndev-aks\n</code></pre> <pre><code>&gt; kubectl config use-context prod-aks\nSwitched to context \"prod-aks\"\n</code></pre> <pre><code>&gt; kubectl config current-context\nprod-aks\n</code></pre></p>"},{"location":"Examples/Example_Deploy_CosmoTech_workspace/#set-up-babylon-context","title":"Set up Babylon Context","text":"<pre><code>babylon namespace use -c test -t dev -s 73a90433\n</code></pre>"},{"location":"Examples/Example_Deploy_CosmoTech_workspace/#initialization-babylon-project","title":"Initialization Babylon project","text":"<p>With Babylon v5, you can now generate a minimal manifest YAML file that can be used to test Babylon.</p> <p>Example</p> <p><pre><code>babylon init --project-folder devops --variables-file devops.yaml \n</code></pre> <pre><code>   \u2192 Cloning Terraform WebApp module...\n   \u2714 Terraform WebApp module cloned\n   \u2192 Created directory: /home/user/CosmoTech/DevOps/babylon_v5_dir/devops\n   \u2714 Generated Organization.yaml\n   \u2714 Generated Solution.yaml\n   \u2714 Generated Workspace.yaml\n   \u2714 Generated Webapp.yaml\n   \u2714 Generated postgres/jobs/k8s_job.yaml\n   \u2714 Generated devops.yaml\n\ud83d\ude80 Project successfully initialized!\n   Path: /home/user/CosmoTech/DevOps/babylon_v5_dir/devops\n\nNext steps:\n   1. Edit your variables in devops.yaml\n   2. Run your first deployment command\n</code></pre> the <code>init</code> command creates a project folder with the following structure: <pre><code>.\n\u251c\u2500\u2500 babylon.log\n\u251c\u2500\u2500 devops\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Organization.yaml\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 postgres\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 jobs\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 k8s_job.yaml\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Solution.yaml\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Webapp.yaml\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Workspace.yaml\n\u251c\u2500\u2500 terraform-webapp\n\u2514\u2500\u2500 devops.yaml\n</code></pre></p>"},{"location":"Examples/Example_Deploy_CosmoTech_workspace/#start-deployment","title":"Start Deployment","text":"<p>Now, we can start running the Babylon command to deploy the workspace.</p> <p>Here is an example of <code>variables.yaml</code> with detailed explanations:</p> <p>variable.yam</p> <pre><code># =========================================================\n# IMPORTANT: You can add variables here as needed!\n# Make sure they are used in the manifest YAML.\n# =========================================================\n# Organization\norganization_name: to_fill    # Should be the name of the project like \"project1 organization\"\n\n# Workspace\nworkspace_name: to_fill       # Should be the name of the project like \"project1 workspace\"\nworkspace_key: to_fill        # Unique key to define according to your naming convention, for example: project1workspace1\nworkspace_description: to_fill              # Quick sentence to explain the purpose of the workspace\n\n# Solution\nsolution_name: to_fill                      # Should be the name of the project like \"project1 solution\"\nsolution_key: to_fill                       # Unique key to define according to your naming convention, for example: project1solution1\nsolution_description: to_fill                # Quick sentence to explain the purpose of the solution\nsimulator_repository: to_fill               # To fill according to your simulator name\nsimulator_version: to_fill                  # To fill according to your simulator version\n# Webapp\ncloud_provider: azure                       # Cloud provider to use (e.g., azure, aws, gcp)\ncluster_name: dev-aks                       # Name of the Kubernetes cluster\ncluster_domain: dev-aks.azure.platform.cosmotech.com  # Domain of the Kubernetes cluster\ntenant: dev                                 # namespace kubernetes (e.g., dev, prod)\nwebapp_name: business                       # Name of the web application\norganization_id: o-xxxxxxxxxxx                         # Organization ID\nazure_subscription_id: xxxxxxxx-xxxx-xxxx-xxxxxxxxxxxx # Azure subscription ID\nazure_entra_tenant_id: xxxxxxxx-xxxx-xxxx-xxxxxxxxxxxx # Azure Entra (AAD) tenant ID\npowerbi_app_deploy: false                              # Set to true if deploying Power BI app, false otherwise\n# Security\n# The list below will be used on all API objects.\n# If differents security list are needed for each API objects,\n# you can copy/paste this list, and edit {{security_&lt;object&gt;}}\n# in files organization.yaml, solution.yaml and workspace.yaml\nsecurity:                                                                   \n  default: none                                                            \n    accessControlList:                                                        \n    - id: admin.user@example.com    # Example of admin user\n        role: admin                                                          \n    - id: editor.user@example.com   # Example of editor user\n        role: editor                                                         \n    - id: viewer.user@example.com   # Example of viewer user\n        role: viewer                                                         \n</code></pre> <p>Now you can launch the <code>apply</code> command to deploy the workspace:</p> <p>Example</p> <p><pre><code>source .venv/bin/activate\n</code></pre> <pre><code>babylon namespace use -c test -t dev -s 73a90433\n</code></pre> <pre><code>babylon apply project/\n</code></pre></p> <p>Here are some simple commands you can use if needed:</p> <p>Example</p> <p><pre><code>babylon api solutions create --oid o-d2yrojeplmo project/Solution.yaml\n</code></pre> <pre><code>babylon api organizations delete --oid o-d2yrojeplmo\n</code></pre> <pre><code>babylon api runners delete --oid o-d2yrojeplmo --wid w-5zompvvrg0j --rid r-mdlq0mk0jo5\n</code></pre></p> <p>It is recommended to use <code>babylon --help</code> to get more details about the arguments of each command.</p> <p>Example</p> <p><pre><code>babylon api organizations delete --help\n</code></pre> <pre><code>Usage: babylon api organizations delete [OPTIONS] ORGANIZATION_ID\n\nDelete an organization by ID\n\nOptions:\n-c, --context TEXT   Context Name without any special character\n-t, --tenant TEXT    Tenant Id without any special character\n-s, --state-id TEXT  State Id\n--oid TEXT           Organization ID  [required]\n--help               Show this message and exit.\n</code></pre></p>"},{"location":"Examples/Example_Update_CosmoTech_workspace/","title":"Update Cosmo Tech workspace","text":"<p>Remember</p> <p>we assumed that the workspace already deployed we need just to update some configuration so this guide we show beast practic to do this with all use cases!</p>"},{"location":"Examples/Example_Update_CosmoTech_workspace/#modifying-access-control-lists-in-api-objects","title":"Modifying Access Control Lists in API Objects","text":"<p>Assuming you need to add users to the access control lists for the Organization, Solution, and Workspace, here is how you can do it:</p> <p>Go to the workspace repository, open the project, and then edit the <code>variables.yaml</code> file. In this example, we add users <code>Alice.Alice.@email.com</code> and <code>Bob.Bob@email.com</code>.</p> <p>variables.yaml</p> <pre><code>organization_security:\n  default: none\n  accessControlList:\n    - id: admin.user@example.com\n      role: admin\n    - id: editor.user@example.com\n      role: editor\n    - id: viewer.user@example.com\n      role: viewer\n    - id: alice.alice.@email.com   # add Alice user as editor\n      role: editor\n    - id: bob.bob@email.com    # add Bob user as viewer\n      role: viewer\n\nsolution_security:\n  default: none\n  accessControlList:\n    - id: admin.user@example.com\n      role: admin\n    - id: editor.user@example.com\n      role: editor\n    - id: viewer.user@example.com\n      role: viewer\n    - id: alice.alice.@email.com   # add Alice user as editor\n      role: editor\n    - id: bob.bob@email.com    # add Bob user as viewer\n      role: viewer\n\nworkspace_security:\n  default: none\n  accessControlList:\n    - id: admin.user@example.com\n      role: admin\n    - id: editor.user@example.com\n      role: editor\n    - id: viewer.user@example.com\n      role: viewer\n    - id: alice.alice.@email.com   # add Alice user as editor\n      role: editor\n    - id: bob.bob@email.com   # add Bob user as viewer\n      role: viewer\n</code></pre>"},{"location":"Examples/Example_Update_CosmoTech_workspace/#applying-babylon-commands","title":"Applying Babylon Commands","text":"<p>After making the necessary modifications, you can now apply the changes using Babylon commands.</p> <p>Babylon Apply</p> <p><pre><code>source .venv/bin/activate\n</code></pre> <pre><code>babylon namespace use -c test -t dev -s 73a90433\n</code></pre> <pre><code>babylon apply project/\n</code></pre></p>"},{"location":"commands/babylon_commands/","title":"Babylon Commands","text":""},{"location":"commands/babylon_commands/#help-command","title":"Help Command","text":"<p>Help command</p> <pre><code>&gt; babylon --help\nUsage: babylon [OPTIONS] COMMAND [ARGS]...\n\n   ____              __                 ___  \n  /\\  _`\\           /\\ \\               /\\_ \\  \n  \\ \\ \\L\\ \\     __  \\ \\ \\____   __  __ \\//\\ \\      ___     ___  \n   \\ \\  _ &lt;'  /'__`\\ \\ \\ '__`\\ /\\ \\/\\ \\  \\ \\ \\    / __`\\ /' _ `\\  \n    \\ \\ \\L\\ \\/\\ \\L\\.\\_\\ \\ \\L\\ \\\\ \\ \\_\\ \\  \\_\\ \\_ /\\ \\L\\ \\/\\ \\/\\ \\  \n     \\ \\____/\\ \\__/.\\_\\\\ \\_,__/ \\/`____ \\ /\\____\\\\ \\____/\\ \\_\\ \\_\\  \n      \\/___/  \\/__/\\/_/ \\/___/   `/___/&gt; \\\\/____/ \\/___/  \\/_/\\/_/  \n                                    /\\___/  \n                                    \\/__/  \n                                                             v5.0.0-beta.2\n\n  CLI used for cloud interactions between CosmoTech and multiple cloud\n  environment\n\nOptions:\n-v, --verbosity LVL   Either CRITICAL, ERROR, WARNING, INFO or DEBUG\n-n, --dry-run         Will run commands in dry-run mode.\n--version             Print version number and return.\n--log-path DIRECTORY  Path to the directory where log files will be stored.\n                        If not set, defaults to current working directory.\n--help                Show this message and exit.\n\nCommands:\napi        Cosmotech API\napply      Macro Apply\ndestroy    Macro Destroy\ninit       Scaffolds a new Babylon project structure using YAML templates.\nnamespace  Babylon namespace\n</code></pre>"},{"location":"commands/babylon_commands/#about-command","title":"About Command","text":"<p>About Command</p> <p><pre><code>babylon api about\n</code></pre> <pre><code>\u2192 Loading configuration from Kubernetes secret...\n\u2192 Sending request to API...\n\u2714 API About Information: version=AboutInfoVersion(full='5.0.0-rc5-897806da', release='5.0.0-rc5', major=5, minor=0, patch=0, label='rc5', build='897806da')\n</code></pre></p>"},{"location":"commands/babylon_commands/#namespace-use-command","title":"Namespace Use Command","text":"<p>Namespace Use</p> <p><pre><code>babylon namespace use -c test -t dev -s 4s5de\n</code></pre> <pre><code> \u2714 Switched to context test, tenant dev successfully\n</code></pre> <pre><code>babylon namespace get-contexts\n</code></pre> <pre><code>babylon namespace get-states local/remote\n</code></pre></p>"},{"location":"commands/babylon_commands/#apply-macro-command","title":"Apply Macro Command","text":"<p>Macro Apply</p> <p><pre><code>babylon apply project/\n</code></pre> <pre><code>babylon apply --var-file devops.yaml devops/\n</code></pre> <pre><code>babylon apply --exclude webapp --var-file devops.yaml devops/ \n</code></pre> <pre><code>babylon apply --include organization --var-file devops.yaml devops/ \n</code></pre></p>"},{"location":"commands/babylon_commands/#apply-single-command","title":"Apply Single Command","text":"<p>Create Organization</p> <p><pre><code>babylon api organizations create project/Organization.yaml\n</code></pre> <pre><code>babylon api organizations delete --oid o-xxxxxxxxxxxxx\n</code></pre> <pre><code>babylon api solutions list --oid o-xxxxxxxxxxxxx\n</code></pre> <pre><code>babylon api workspaces get --oid o-xxxxxxxxxxxxx --wid w-xxxxxxxxxxxxx\n</code></pre></p>"},{"location":"commands/babylon_commands/#destroy-macro-command","title":"Destroy Macro Command","text":"<p>Macro Destroy</p> <p><pre><code>babylon destroy\n</code></pre> <pre><code>babylon destroy --include workspace\n</code></pre> <pre><code>babylon destroy --exclude organization\n</code></pre></p>"},{"location":"guides/az_requirements/","title":"Az requirements","text":""},{"location":"guides/az_requirements/#azure-requirements","title":"Azure requirements","text":"<p>Requirements</p> <p>The following elements are required before you can use Babylon on an Azure subscription</p> <ul> <li> <p>Fully set up Cosmo Tech Platform installed on your Azure Tenant</p> </li> <li> <p>App registration for Babylon</p> </li> </ul> <p>Babylon uses a Service Principal to interact with the API and other resources. To do so, Babylon needs to be registered as an application in the Azure Active Directory.</p> <p>This App Registration will be used to authenticate and get the required tokens to connect to your Platform. Rights on the App Registration depends on the type of connection you want to make. </p> <p>We recommend defining this app registration as a mobile and desktop application in Azure configuration with redirection URL (mostly for authenticating against Azure services.</p> <p>See official documentation :</p> <pre><code>* https://learn.microsoft.com/en-us/entra/identity-platform/v2-oauth2-auth-code-flow\n* https://learn.microsoft.com/en-us/entra/identity-platform/msal-client-application-configuration\n* https://learn.microsoft.com/en-us/onedrive/developer/rest-api/getting-started/msa-oauth?view=odsp-graph-online\n</code></pre> <p>The App registration needs the following API permissions:</p> <p>API Permissions</p> <p>Microsoft Graph \ud83d\udd39 Application.ReadWrite.All (Application) \ud83d\udd39 Application.ReadWrite.OwnedBy (Application) \ud83d\udd39 Group.ReadWrite.All (Delegated) \ud83d\udd39 User.Read (Delegated) </p> <p>Platform API \ud83d\udd39 Platform.Admin (Application) </p> <p>For those concerned with specifics Azure policies, all Microsoft Graph's permissions can be deleted excepted User.Read (Delegated), but this implies that some operations would be handled manually. The platform API permission is mandatory.</p> <p>Important</p> <p>Babylon App registration needs at least Contributor role on Cosmo Tech Platform Resource Group.</p>"},{"location":"guides/resource_file/","title":"Resource file","text":"<p>If the state file does not exist, the first Babylon command you run will initialize a new state and persist it locally.</p> <p>Note</p> <ul> <li>To enable persistence in the cloud, you must set the parameter <code>remote: true</code>.   (This will be explained in detail in the Deploy Workspace tutorial, just keep it in mind for now.)</li> <li>The structure and content of the state may change in future releases as needed.</li> </ul>"},{"location":"guides/resource_file/#cloud-state-configuration","title":"Cloud State Configuration","text":"<p>When you set <code>remote: true</code> and run <code>babylon apply</code>, you might encounter an error initially.</p> <p>Error</p> <pre><code>\ud83d\ude80 Deploying Organization in namespace: sphinx\n  \u2718 Failed to initialize BlobServiceClient: Missing environment variables: 'STORAGE_NAME' and 'ACCOUNT_SECRET'\n</code></pre> <p>This is expected behavior as the cloud state requires specific environment variables to authenticate with your storage.</p> <p>To use the cloud state, you must set the following environment variables:</p> Variable Description <code>STORAGE_NAME</code> The name of your Azure Storage Account. <code>ACCOUNT_SECRET</code> Your Storage Account access key. <p>To find your ACCOUNT_SECRET, follow these steps in the Azure Portal:</p> <ol> <li>Navigate to your Storage Account.</li> <li>In the left-hand menu, go to the Security + networking section.</li> <li>Click on Access keys.</li> <li>You can use either <code>key1</code> or <code>key2</code> as your secret.</li> </ol> <p></p> <p>Security Best Practice</p> <p>Never commit your <code>ACCOUNT_SECRET</code> to a git repository. Always use environment variables or a secret manager to keep your credentials safe</p> <p>How to set them :</p> <p>Important</p> \ud83d\udda5\ufe0f Windows\ud83d\udc27 Linux <pre><code>$env:STORAGE_NAME=\"your_storage_account_name\"\n$env:ACCOUNT_SECRET=\"your_access_key\"\n</code></pre> <pre><code>export STORAGE_NAME=\"your_storage_account_name\"\nexport ACCOUNT_SECRET=\"your_access_key\"\n</code></pre>"},{"location":"guides/resource_file/#babylon-state-structure","title":"Babylon State Structure","text":"<p>The Babylon state is a structured YAML file composed of multiple sections. At a high level, you will find three main entries: <pre><code>context:\nfiles: []\nid: \ntenant:\nservices:\n  api:\n    organization_id: \n    solution_id: \n    workspace_id: \n  postgres:\n    schema_name: \n  webapp:\n    webapp_name: \n    webapp_url:\n</code></pre></p>"},{"location":"guides/tfc_requirements/","title":"Terraform Cloud Requirements","text":"Requirements <p>The following elements are required before you can use Babylon on Terraform Cloud  - A Terraform Cloud organization token, for workspace creation or configuration  - A Terraform Cloud user token, for workspace configuration or execution</p>"},{"location":"guides/tfc_requirements/#allow-access-to-terraform-cloud","title":"Allow access to Terraform Cloud","text":"<p>Babylon uses the Terraform Cloud tokens to authenticate users and allow them to interact with the API. For operation on workspaces you will need to add a oauth token to terraform-cloud in the webapp. Once this oauth token you will add its id to your workspace configuration with babylon. - babylon terraform-cloud workspace create</p> <p>You can use the following commands to setup your token secrets in your <code>.secrets.yaml.encrypt</code> file for <code>Babylon</code> to use it directly !   - babylon terraform-cloud login   - babylon terraform-cloud logout </p>"},{"location":"guides/vault_requirements/","title":"Vault service","text":"<p>Requirements</p> <p>The following elements are required before you can use Babylon on an Azure subscription</p> Vault requirements"},{"location":"partials/installation/from_docker/","title":"From docker","text":""},{"location":"partials/installation/from_docker/#get-babylon-from-docker","title":"Get Babylon from docker","text":"Prerequisites Requirement Docker <p>Choosing the version of Babylon you want to use you can run the following command</p> Download docker image <pre><code>docker pull ghcr.io/cosmo-tech/babylon:latest\ndocker tag ghcr.io/cosmo-tech/babylon:latest babylon\n</code></pre> <p>It will download for you the required docker image, and rename it to <code>babylon</code></p> Start Babylon docker image <p>Using the following command you get in a working Babylon environment, allowing you to run any command you will like <pre><code>docker run -ti --rm babylon\n</code></pre></p> <p>Warning</p> <p>In this environment your changes to the files won't be persisted when you leave it. The following tips will help you set up persitance for your config, but will use knowledge of Babylon explained in future guides.</p> Persist configurations and use local content as a working dir Info <p>This tip concern some principle of Babylon explained is other guides, you can skip it for now if you want to understand those principles before running commands using them.</p> <p>To persist configuration we will use the <code>--mount</code> option of Docker to persist our data across runs</p> Persist configuration <pre><code>mkdir babylon_config\ndocker run -ti --rm --mount type=bind,source=\"$(pwd)\"/babylon_config,target=/opt/babylon babylon\n</code></pre> <p>This command will persist your Babylon configuration in a local <code>/babylon_config</code> folder allowing you to keep it across runs (in the same folder)</p> <p>Now if you want to use your local files as a working directory for your commands you can do the following</p> Use local folder as working dir <pre><code>docker run -ti --rm --mount type=bind,source=\"$(pwd)\",target=/etc/babylon/workingdir babylon\n</code></pre> <p>This command will use your current folder as a working directory for your babylon commands</p> <p>Combining both options allows for a persistent content and config across runs</p> Combine both for persitence <pre><code>docker run -ti --rm --mount type=bind,source=\"$(pwd)\"/babylon_config,target=/opt/babylon --mount type=bind,source=\"$(pwd)\",target=/etc/babylon/workingdir babylon\n</code></pre> Use aliases to make a babylon command using docker <p>Info</p> <ul> <li>Only work on system having the <code>alias</code> command</li> <li>Won't allow you to use auto-completion</li> </ul> <p>The following command will create a command <code>babylon</code> having the same use as the one you would get by installing the sources but by using docker.</p> <code>babylon</code> alias command <pre><code>alias babylon=\"docker run -ti --rm --mount type=bind,source=$(pwd)/babylon_config,target=/opt/babylon --mount type=bind,source=$(pwd),target=/etc/babylon/workingdir --entrypoint babylon babylon\"\n</code></pre>"},{"location":"partials/installation/from_git/","title":"From git","text":"<p>Get sources from git</p> <p>You can download the latest version of Babylon using git clone command</p> <p>Latest Version</p> <pre><code>git clone git@github.com:Cosmo-Tech/Babylon.git babylon\ncd babylon\n</code></pre> <p>Get the specific version from git</p> <p>If you want a specific version of Babylon (e.g. v5.0.0-beta.2)</p> <p>Specific Version</p> <pre><code>git clone -b v5.0.0-beta.2 git@github.com:Cosmo-Tech/Babylon.git babylon\ncd babylon\n</code></pre>"},{"location":"partials/installation/from_source/","title":"From source","text":""},{"location":"partials/installation/from_source/#get-babylon-from-source","title":"Get Babylon from source","text":"<p>Requirements</p> <ul> <li> <p>\ud83d\udc0d Python 3.10+</p> </li> <li> <p>\ud83d\udce6 Pip 22.2+</p> </li> <li> <p>\ud83c\udf31 Git</p> </li> <li> <p>\ud83d\udce6 Uv 0.9.13+</p> </li> <li> <p>\u2601\ufe0f Azure CLI</p> </li> <li> <p>\u2638\ufe0f Kubectl </p> </li> </ul> <p>We will go through the process of getting a version of Babylon before the installation.</p> <p>Get sources from git</p> <p>You can download the latest version of Babylon using git clone command</p> <p>Latest Version</p> <pre><code>git clone git@github.com:Cosmo-Tech/Babylon.git babylon\ncd babylon\n</code></pre> <p>Get the specific version from git</p> <p>If you want a specific version of Babylon (e.g. v5.0.0-beta.2)</p> <p>Specific Version</p> <pre><code>git clone -b v5.0.0-beta.2 git@github.com:Cosmo-Tech/Babylon.git babylon\ncd babylon\n</code></pre>"},{"location":"partials/installation/from_source/#install-babylon","title":"Install Babylon","text":"<p>There are two ways to install Babylon: using uv or using venv. Currently, the recommended method is uv. You can follow the official instructions here: UV Installation Guide.</p> <p>You can install Babylon globally on your system:</p> <p>Uv</p> \ud83d\udc27 Linux\ud83d\udda5\ufe0f Windows <pre><code>uv venv\nsource .venv/bin/activate\nuv pip install .\n</code></pre> <p>After the installation of uv, it is highly recommended to reopen a new terminal window! <pre><code>uv venv\n.\\.venv\\Scripts\\activate\nuv pip install .\n</code></pre></p> <p>Py</p> \ud83d\udc27 Linux\ud83d\udda5\ufe0f Windows <pre><code>python3 -m venv .venv\nsource .venv/bin/activate\npip install .\n</code></pre> <pre><code>python -m venv .venv\n.\\.venv\\Scripts\\activate\npip install .\n</code></pre> <p>Alternatively, follow these steps if you want to install Babylon in development mode:</p> <p>Uv</p> <pre><code>uv pip install -e . --group dev\n</code></pre> <p>Py</p> <pre><code>pip install -e .\n</code></pre>"},{"location":"partials/installation/prerequisites/","title":"Prerequisites","text":"<ul> <li> <p>\ud83d\udc0d Python 3.10+</p> </li> <li> <p>\ud83d\udce6 Pip 22.2+</p> </li> <li> <p>\ud83c\udf31 Git</p> </li> <li> <p>\ud83d\udce6 Uv 0.9.13+</p> </li> <li> <p>\u2601\ufe0f Azure CLI</p> </li> <li> <p>\u2638\ufe0f Kubectl </p> </li> </ul>"},{"location":"tutorial/","title":"Tutorials","text":"<p>A list of tutorials to start using Babylon v5.</p> <p> Getting started with Babylon v5</p> <p>In this guide you'll learn how to install, run commands, and experiment with Babylon.</p> <p> Step 1</p> <p> Deploy a new Workspace</p> <p>This guide will help you deploy a new organization, solution, and workspace.</p> <p> Step 2</p> <p> Deploy a Workspace with an existing Organization and/or Solution</p> <p>This guide will help you deploy a workspace with existing organization and solution resources.</p> <p> Step 3</p> <p> Destroy a Workspace</p> <p>This guide will show you how to destroy a workspace.</p> <p> Destroy</p>"},{"location":"tutorial/Deploy_CosmoTech_workspace/","title":"Deploy Cosmo Tech workspace","text":"<p>Remember</p> <p>This guide focuses on explaining each object individually. A complete deployment workflow is provided in the Examples section, where all components are combined in a practical scenario !</p> <p>Before proceeding, ensure that you have selected the correct <code>tenant</code>.</p> <p>In this example, we will use the following identifiers:</p> <ul> <li><code>context_id</code>: <code>test</code> </li> <li><code>tenant_id</code>: <code>dev</code> </li> <li><code>state_id</code>: <code>8db6069e</code></li> </ul> <p>To deploy a complete Cosmo Tech workspace, you can declare its configuration in yaml files corresponding to specific deployment type. </p> <p>Each file contains general information about the deployment:</p> <p>Important</p> <p>In this tutorial each Cosmo Tech object, values defined directly within the corresponding YAML file. However, in the Examples section, you will see that we use a centralized <code>variables.yaml</code> file, which defines all required variables and is then referenced across the YAML configurations !</p>"},{"location":"tutorial/Deploy_CosmoTech_workspace/#api-organization","title":"API Organization","text":"<p><pre><code>kind: Organization\nnamespace:\n  remote: true   # false by default\n</code></pre> The deployment configuration must define the following keys:</p> <ul> <li> <p><code>kind</code>   Specifies the type of resource to deploy.   Accepted values: <code>Organization</code>, <code>Solution</code>, <code>Workspace</code>, <code>WebApp</code>.  </p> <p>\u26a0\ufe0f The resource type must always start with a capital letter.</p> </li> <li> <p><code>namespace</code>   Provides metadata that uniquely identifies the deployment, including for now just:  </p> <ul> <li><code>remote</code>   A boolean flag indicating whether the state should be stored locally only (<code>false</code>, default) or both locally and in the cloud (<code>true</code>)</li> </ul> </li> <li> <p><code>spec</code>   Defines the resource configuration. The details are specified under the <code>payload</code> section.</p> </li> </ul> <p>For example, in an Organization deployment file:</p> <p>Organization.yaml</p> <pre><code>kind: Organization\nnamespace:\n  remote: true   # false by default\nspec:\n  payload:\n    name: \"{{organization_name}}\"\n    security: {{security}}\n</code></pre> <p>All keys in this file can be templated with <code>{{}}</code> syntax for objects and <code>\"{{}}\"</code> for strings, as <code>security</code> section of this file. Corresponding values must be stored in <code>variables.yaml</code> file at the same level that your project See \ud83d\udc49 Examples:</p> <pre><code>security:\n  default: viewer\n  accessControlList:\n    - id: user1@email.com\n      role: admin\n    - id: user2@email.com\n      role: editor\n    - id: user3@email.com\n      role: viewer\n</code></pre>"},{"location":"tutorial/Deploy_CosmoTech_workspace/#api-solution","title":"API Solution","text":"<p>This is how the solution deployment file is structured</p> <p>Solution.yaml</p> <pre><code>kind: Solution\nnamespace:\n  remote: true   # false by default\nmetadata:\n  selector:\n    organization_id: \"{{services['api.organization_id']}}\"\nspec:\n  payload:\n    key: \"demosolution\"\n    name: \"My Solution Name\"\n    description: \"My solution description\"\n    repository: brewery_for_continuous\n    version: latest\n    sdkVersion: '10.4.0'\n    alwaysPull: true\n    url: 'https://webapp.com'\n    tags:\n      - brewery\n    runTemplates:\n      - id: \"run_id\"\n        name: \"Standard simulation\"\n        csmSimulation: AzureWebApp/AzureWebApp_Simulation\n        run: true\n        preRun: true\n    parameters:\n    parameterGroups:\n    security:\n      default: none\n      accessControlList:\n        - id: user1@email.com\n          role: admin\n        - id: user2@email.com\n          role: editor\n        - id: user3@email.com\n          role: viewer\n</code></pre> <p>The <code>metadata</code> section defines deployment specific attributes. It is required in the following resource files:  </p> <ul> <li><code>solution.yaml</code> </li> <li><code>workspace.yaml</code> </li> </ul> <p>The <code>selector</code> block is used to specify the target organization under which the resource will be deployed.  </p> <ul> <li> <p>Parameter: <code>organization_id</code> </p> <ul> <li>Purpose:   Defines the unique organization in which the solution (or other resource) will be created.  </li> </ul> </li> <li> <p>Behavior:  </p> <ul> <li>Babylon will associate the deployment (e.g., a solution, workspace) with the specified organization_id.  </li> <li>Typically, this value is injected dynamically from the Babylon state (<code>services['api.organization_id']</code>).  </li> </ul> </li> </ul>"},{"location":"tutorial/Deploy_CosmoTech_workspace/#api-workspace","title":"API Workspace","text":"<p>The Workspace configuration may include additional parameters required to provision external services.</p> <p>These parameters are normally defined under the <code>sidecars</code> section.</p> <p>One of the major changes is the replacement of the <code>ADX</code> database with <code>PostgreSQL</code> by default. Babylon now automatically creates a dedicated PostgreSQL schema for each workspace, which can be used to store runner results. As a result, the <code>sidecars</code> section now references <code>postgres</code> instead of <code>ADX</code>.</p>"},{"location":"tutorial/Deploy_CosmoTech_workspace/#postgresql-schema-creation-with-kubernetes-job","title":"PostgreSQL Schema Creation with Kubernetes Job","text":"<p>With the new workspace configuration, Babylon leverages a Kubernetes job to automate the creation of a PostgreSQL schema for each workspace. This is defined under the <code>sidecars.postgres.schema.jobs</code> section:</p> <p>When <code>create</code> is set to <code>true</code>, Babylon will execute the specified Kubernetes job (<code>k8s_job.yaml</code>) located in the <code>postgres/jobs</code> directory. This job is responsible for initializing the PostgreSQL schema required by the workspace. This approach ensures that each workspace has its own isolated schema, improving data management and security.</p> <p>Workspace.yaml</p> <pre><code>kind: Workspace\nnamespace:\n  remote: true   # false by default\nspec:\n  sidecars:\n    postgres:\n      schema:\n        create: true # false by default\n        jobs:\n          - name: k8s_job.yaml\n            path: postgres/jobs\n  payload:\n    key: \"Project1\"\n    name: \"My Workspace Name\"\n    description: \"Workspace for solution\"\n    solution:\n      solutionId: \"{{services['api.solution_id']}}\"\n    useDedicatedEventHubNamespace: true\n    sendScenarioMetadataToEventHub: true\n    sendInputToDataWarehouse: true\n    sendScenarioRunToEventHub: true\n    additionalData:\n      webapp:\n        solution:\n          runTemplateFilter:\n          defaultRunTemplateDataset: null\n        charts:\n          workspaceId:\n          logInWithUserCredentials: false\n          scenarioViewIframeDisplayRatio: 4.514285714\n          dashboardsViewIframeDisplayRatio: 1.610062893\n          useWebappTheme: true\n          dashboardsView:\n          scenarioView:\n        menu:\n          supportUrl: 'https://support.cosmotech.com'\n          organizationUrl: 'https://cosmotech.com'\n          documentationUrl: 'https://portal.cosmotech.com/resources/platform-resources/web-app-user-guide'\n        datasetManager: 'removeToDisableDatasetManager'\n        datasourceFilter: []\n    security:\n      default: none\n      accessControlList:\n        - id: user1@email.com\n          role: admin\n        - id: user2@email.com\n          role: editor\n        - id: user3@email.com\n          role: viewer\n</code></pre>"},{"location":"tutorial/Deploy_CosmoTech_workspace/#cosmo-tech-web-app","title":"Cosmo Tech Web App","text":"<p>To deploy a Cosmo Tech Web App now is possible with Babylon.</p> <p>Babylon now supports deploying web applications using Terraform as backend. This integration allows you to provision and manage web app infrastructure as code directly through Babylon, streamlining the deployment process.</p> <p>For more details on how to deploy the web app, refer to the README file in the Terraform web app module: \ud83d\udc49 Terraform Module.</p> <p>Babylon automatically clones the Terraform web app repository and updates the <code>terraform.tfvars</code> file with all required variables. These variables are retrieved from the <code>webapp.yaml</code> configuration file below.</p> <p>webapp.yaml</p> <pre><code>kind: Webapp\nnamespace:\n   remote: true\nspec:\n   payload:\n      cloud_provider: \"azure\"\n      cluster_name: \"{{cluster_name}}\"\n      cluster_domain: \"{{cluster_domain}}\"\n      tenant: \"{{tenant}}\"\n      webapp_name: \"{{webapp_name}}\"\n      organization_id: \"{{services['api.organization_id']}}\"\n      azure_subscription_id: \"{{azure_subscription_id}}\"\n      azure_entra_tenant_id: \"{{azure_entra_tenant_id}}\"\n      powerbi_app_deploy: false\n</code></pre>"},{"location":"tutorial/Deploy_CosmoTech_workspace/#babylon-project-structure","title":"Babylon project structure","text":"<p>Project folder must have the following structure:</p> <p>Tree</p> <pre><code>.\n\u251c\u2500\u2500 babylon.log\n\u251c\u2500\u2500 project\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Organization.yaml\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 postgres\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 jobs\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 k8s_job.yaml\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Solution.yaml\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Webapp.yaml\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Workspace.yaml\n\u251c\u2500\u2500 terraform-webapp\n\u2514\u2500\u2500 variables.yaml\n</code></pre>"},{"location":"tutorial/Deploy_CosmoTech_workspace/#launching-the-deployment-macro-command","title":"Launching the deployment Macro command","text":"<p>After filling all deployment files, you can launch the following command:</p> <p>Babylon Macro apply</p> <pre><code>babylon apply project/\n</code></pre> <p>Babylon will create and deploy all resources and save it in the state.  Keeping this information in the state simplifies modification of the resources as you can edit one of the project deployment files and relaunch <code>babylon apply</code> command. It will update existing resources or create missing ones, for example, in case when Babylon was granted more rights between two <code>apply</code> commands.</p> <p>You can also specify different variable files when launching the <code>babylon apply</code> command. </p> <p>To do this, use the <code>--var-file</code> option.</p> <p>Example</p> <pre><code>babylon apply --var-file variable_file_1.yaml --var-file variable_file_2.yaml project/\n</code></pre> <p>Remember</p> <p>If you don't specify a variable file, Babylon will use the default variable file <code>variables.yaml</code></p>"},{"location":"tutorial/Deploy_CosmoTech_workspace/#executing-babylon-apply-on-a-single-object-api","title":"Executing babylon apply on a Single Object API","text":"<p>Babylon now supports deploying or updating a single object API using the <code>apply</code> macro command. This enhancement makes it easier to maintain and update only the specific object that has changed, instead of running the macro for all objects following best practices for efficient deployments.</p> <p>To support this, Babylon introduces two new options: <code>--include</code> <code>--execlude</code></p> Option Description <code>--include</code> Specifies only the objects to be included in the action. <code>--exclude</code> Specifies the objects to be skipped during the action. <p>include</p> <p><pre><code>babylon apply --include organization project\n</code></pre> <pre><code>\ud83d\ude80 Deploying Organization in namespace: dev\n    \u2192 Loading configuration from Kubernetes secret...\n    \u2192 No existing organization ID found. Creating...\n    \u2714 Organization o-nl8pgn5lpwd created\n\n\ud83d\udccb Deployment Summary\n    \u2022 Organization Id : o-nl8pgn5lpwd\n\n\u2728 Deployment process complete\n</code></pre></p> <p>exclude</p> <p><pre><code>babylon apply --exclude workspace project/\n</code></pre> <pre><code>\ud83d\ude80 Deploying Organization in namespace: dev\n    \u2192 Loading configuration from Kubernetes secret...\n    \u2192 No existing organization ID found. Creating...\n    \u2714 Organization o-nl8pgn5lpwd created\n\n\ud83d\ude80 Deploying Solution in namespace: dev\n    \u2192 Loading configuration from Kubernetes secret...\n    \u2192 No existing solution ID found. Creating...\n    \u2714 Solution sol-6069lgex2xz created\n\n\ud83d\udccb Deployment Summary\n    \u2022 Organization Id : o-nl8pgn5lpwd\n    \u2022 Solution Id     : sol-6069lgex2xz\n\n\u2728 Deployment process complete\n</code></pre></p>"},{"location":"tutorial/Deploy_workspace_with_existing_org_sol/","title":"Deploy Cosmo Tech workspace with an existing organization and solution","text":"<p>Remember</p> <p>This guide focuses on explaining who we can deploy a wokspace with an existing organization and solution. A complete deployment workflow is provided in the Examples section, where all components are combined in a practical scenario !</p> <p>Before proceeding, ensure that you have selected the correct <code>platform</code> and <code>project</code>. If unsure, contact your <code>Babylon administrator</code> for the available options. In this example, we will use</p> <ul> <li>context_id: <code>test</code></li> <li>tenant_id: <code>dev</code></li> <li>state_id: <code>8db6069e</code></li> </ul> <p>Before going further, you should know that we have two concepts: deploying a solution object within an existing organization, and deploying a workspace object within an existing organization and solution. This is just to give you some quick context for the tutorial.</p>"},{"location":"tutorial/Deploy_workspace_with_existing_org_sol/#deploy-a-new-solution-within-an-existing-organization","title":"Deploy a new solution Within an existing organization","text":"<p>In this section, we will walk through deploying a Solution within an existing Organization. This setup assumes that:</p> <ul> <li>You already have at least one Organization deployed.</li> <li>A Solution can be deployed and linked to this existing organization.</li> </ul> <p>To deploy a new Solution within an existing Organization, you must declare its configuration in the YAML file. The main changes occur in the <code>solution.yaml</code> file, where you add the <code>metadata</code> section.</p>"},{"location":"tutorial/Deploy_workspace_with_existing_org_sol/#metadata-overview","title":"Metadata Overview","text":"<p>The <code>metadata</code> section contains deployment specific data and can appear in:</p> <ul> <li><code>solution.yaml</code></li> <li><code>workspace.yaml</code></li> </ul>"},{"location":"tutorial/Deploy_workspace_with_existing_org_sol/#selector-overview","title":"Selector Overview","text":"<p>Within <code>metadata</code>, there is a nested section called <code>selector</code> where you can set the <code>organization_id</code> field. This allows deployment of a solution within an existing organization.</p> <p>Important</p> <p>Add <code>organization_id</code> to the <code>variables.yaml</code> file.</p> <p>variables.yaml</p> <pre><code># API \norganization_id: o-rv0x8vd464kl\n</code></pre> <p>Below is an example of the solution manifest structure.</p> <p>solution.yaml</p> <pre><code>kind: Solution\nnamespace:\n  remote: true   # false by default\nmetadata:\n  selector:\n    organization_id: \"{{organization_id}}\" # &lt;---\nspec:\n  payload:\n    key: \"demosolution\"\n    name: \"My Solution Name\"\n    description: \"My solution description\"\n    repository: brewery_for_continuous\n    version: latest\n    sdkVersion: '10.4.0'\n    alwaysPull: true\n    url: 'https://webapp.com'\n    tags:\n      - brewery\n    runTemplates:\n      - id: \"run_id\"\n        name: \"Standard simulation\"\n        csmSimulation: AzureWebApp/AzureWebApp_Simulation\n        run: true\n        preRun: true\n    parameters:\n    parameterGroups:\n    security:\n      default: none\n      accessControlList:\n        - id: user1@email.com\n          role: admin\n        - id: user2@email.com\n          role: editor\n        - id: user3@email.com\n          role: viewer\n</code></pre>"},{"location":"tutorial/Deploy_workspace_with_existing_org_sol/#deploy-a-new-workspace-withing-an-existing-solution-and-organization","title":"Deploy a new workspace withing an existing solution and organization","text":"<p>Similarly, you can deploy a new Workspace within an existing Organization and Solution.  </p> <p>To do this, add both <code>organization_id</code> and <code>solution_id</code> under <code>metadata.selector</code> in the workspace configuration file.</p> <p>Workspace.yaml</p> <pre><code>kind: Workspace\nnamespace:\n  remote: true   # false by default\nmetadata:\n  selector:\n    organization_id: \"{{organization_id}}\" # &lt;--- \n    solution_id: \"{{solution_id}}\"         # &lt;---\nspec:\n  sidecars:\n    cloud:\n  payload:\n    key: \"Project1\"\n    name: \"My Workspace Name\"\n    description: \"Workspace for solution\"\n    solution:\n      solutionId: \"{{services['api.solution_id']}}\"\n    useDedicatedEventHubNamespace: true\n    sendScenarioMetadataToEventHub: true\n    sendInputToDataWarehouse: true\n    sendScenarioRunToEventHub: true\n    additionalData:\n      webApp:\n        solution:\n          runTemplateFilter:\n          defaultRunTemplateDataset: null\n        charts:\n          workspaceId:\n          logInWithUserCredentials: false\n          scenarioViewIframeDisplayRatio: 4.514285714\n          dashboardsViewIframeDisplayRatio: 1.610062893\n          useWebappTheme: true\n          dashboardsView:\n          scenarioView:\n        menu:\n          supportUrl: 'https://support.cosmotech.com'\n          organizationUrl: 'https://cosmotech.com'\n          documentationUrl: 'https://portal.cosmotech.com/resources/platform-resources/web-app-user-guide'\n        datasetManager:\n    security:\n      default: none\n      accessControlList:\n        - id: user1@email.com\n          role: admin\n        - id: user2@email.com\n          role: editor\n        - id: user3@email.com\n          role: viewer\n</code></pre> <p>Make sure to reference the corresponding <code>organization_id</code> and <code>solution_id</code> values declared in your <code>variables.yaml</code> file.</p> <p>variables.yaml</p> <pre><code># API \norganization_id: o-rv0x8vd464kl\nsolution_id: sol-wryolow98dsg\n</code></pre> <p>Now, with this Babylon feature, you can deploy multiple Workspaces that:</p> <ol> <li>Share the same Organization and Solution.</li> <li>Share the same Organization but use different Solutions.</li> </ol> <p>Important</p> <p>For each workspace deployment, you need a specific state file.</p> <p>e.g :  <code>state.&lt;context_id&gt;.&lt;tenant_id&gt;.&lt;state_id&gt;.yaml</code></p>"},{"location":"tutorial/Destroy_workspace/","title":"Destroy a Cosmo Tech Workspace","text":"<p>Remember</p> <p>Keep in mind that the <code>destroy</code> command is a macro command that removes everything deployed.</p> <p>If you no longer need a Cosmo Tech workspace, you can remove it and all associated resources using the <code>babylon destroy</code> macro command. This will automatically delete the following resources:</p> <ul> <li>Organizations</li> <li>Solutions</li> <li>Workspaces</li> <li>PostgreSQL schemas</li> <li>Web App</li> </ul> <p>By default, it destroys the resources referenced in the current state saved in the namespace file.</p> <p>To view the current context and state being used by Babylon, run the following command:</p> <pre><code>babylon namespace get-contexts\n</code></pre> <p><pre><code>CURRENT  CONTEXT          TENANT  STATE ID  \n*        test             dev     state \n</code></pre> When is the case you run simplement </p> <p><pre><code>&gt; babylon destroy\n</code></pre> <pre><code>\ud83d\udd25 Starting Destruction Process in namespace: dev\n    \u2192 Loading configuration from Kubernetes secret...\n    \u2192 Existing ID sol-9epr7jxn2ndl found. Deleting...\n    \u2714 Solution sol-9epr7jxn2ndl deleted\n    \u2192 Found PostgreSQL service postgresql\n    \u2192 Destroying postgreSQL schema for workspace w-0rnd73k2kyd5...\n    \u2192 Applying kubernetes destroy job...\n    \u2192 Waiting for job postgresql-destroy-w-0rnd73k2kyd5 to complete...\n    \u2192 Checking job logs for errors...\n    \u2714 Schema destruction w_0rnd73k2kyd5 completed successfully\n    \u2192 Existing ID w-0rnd73k2kyd5 found. Deleting...\n    \u2714 Workspace w-0rnd73k2kyd5 deleted\n    \u2192 Existing ID o-841ez282ypmx found. Deleting...\n    \u2714 Organization o-841ez282ypmx deleted\n    \u2192 Running Terraform destroy for WebApp resources...\n    Acquiring state lock. This may take a few moments...\n    module.chart-keycloak-client.data.kubernetes_secret.keycloak: Reading...\n    module.chart-cosmotech-webapp.kubernetes_config_map.webapp: Destruction complete after 0s\n\n    Destroy complete! Resources: 5 destroyed.\n    \u2714 WebApp webapp-business destroyed  \n\n\ud83d\udccb Destruction Summary\n  \u2022 Organization Id : DELETED\n  \u2022 Solution Id     : DELETED\n  \u2022 Workspace Id    : DELETED\n  \u2022 Webapp Name     : DELETED\n\n\u2728 Cleanup process complete\n</code></pre></p>"},{"location":"tutorial/Destroy_workspace/#selective-destruction","title":"Selective Destruction","text":"<p>The same include/exclude philosophy applies to resource destruction. This allows you to avoid removing specific objects or to target only a single resource for deletion.</p> <p>To prevent removing a specific object while destroying others, or to focus on a single one, use the following flags:</p> <p>\ud83d\uddd1\ufe0f Targeted Destruction</p> <p>Destroy only a specific object (e.g., only the workspace): <pre><code>babylon destroy --include workspace\n</code></pre> <pre><code>\ud83d\udd25 Starting Destruction Process in namespace: dev\n    \u2192 Loading configuration from Kubernetes secret... \n    \u2192 Existing ID w-3pkx99z1k3v found. Deleting...\n    \u2714 Workspace w-3pkx99z1k3v deleted\n\n\ud83d\udccb Destruction Summary\n    \u2022 Organization Id : o-9zmdn7w95k2\n    \u2022 Solution Id     : sol-4vqjmov980v\n    \u2022 Workspace Id    : DELETED\n</code></pre></p> <p>\ud83d\udee1\ufe0f Protected Destruction</p> <p>Destroy everything except a specific object (e.g., keep the organization): <pre><code>babylon destroy --exclude organization\n</code></pre> <pre><code>\ud83d\udd25 Starting Destruction Process in namespace: dev\n    \u2192 Loading configuration from Kubernetes secret...\n    \u2192 Existing ID sol-4vqjmov980v found. Deleting...\n    \u2714 Solution sol-4vqjmov980v deleted\n    \u26a0 No Workspace ID found in state! skipping deletion\n\n\ud83d\udccb Destruction Summary\n    \u2022 Organization Id : o-9zmdn7w95k2\n    \u2022 Solution Id     : DELETED\n    \u2022 Workspace Id    : DELETED\n\n\u2728 Cleanup process complete\n</code></pre></p> <p>Safety First</p> <p>Always run <code>babylon namespace get-contexts</code> before a destruction command to verify which environment you are currently targeting.</p>"},{"location":"tutorial/Getting_started/","title":"Getting started with Babylon","text":"<p>This is a guide to getting started with Babylon v5. You'll learn how to install, run, and experiment with Babylon.</p>"},{"location":"tutorial/Getting_started/#get-babylon-from-source","title":"Get Babylon from source","text":"<p>Requirements</p> <ul> <li> <p>\ud83d\udc0d Python 3.10+</p> </li> <li> <p>\ud83d\udce6 Pip 22.2+</p> </li> <li> <p>\ud83c\udf31 Git</p> </li> <li> <p>\ud83d\udce6 Uv 0.9.13+</p> </li> <li> <p>\u2601\ufe0f Azure CLI</p> </li> <li> <p>\u2638\ufe0f Kubectl </p> </li> </ul> <p>We will go through the process of getting a version of Babylon before the installation.</p> <p>Get sources from git</p> <p>You can download the latest version of Babylon using git clone command</p> <p>Latest Version</p> <pre><code>git clone git@github.com:Cosmo-Tech/Babylon.git babylon\ncd babylon\n</code></pre> <p>Get the specific version from git</p> <p>If you want a specific version of Babylon (e.g. v5.0.0-beta.2)</p> <p>Specific Version</p> <pre><code>git clone -b v5.0.0-beta.2 git@github.com:Cosmo-Tech/Babylon.git babylon\ncd babylon\n</code></pre>"},{"location":"tutorial/Getting_started/#install-babylon","title":"Install Babylon","text":"<p>There are two ways to install Babylon: using uv or using venv. Currently, the recommended method is uv. You can follow the official instructions here: UV Installation Guide.</p> <p>You can install Babylon globally on your system:</p> <p>Uv</p> \ud83d\udc27 Linux\ud83d\udda5\ufe0f Windows <pre><code>uv venv\nsource .venv/bin/activate\nuv pip install .\n</code></pre> <p>After the installation of uv, it is highly recommended to reopen a new terminal window! <pre><code>uv venv\n.\\.venv\\Scripts\\activate\nuv pip install .\n</code></pre></p> <p>Py</p> \ud83d\udc27 Linux\ud83d\udda5\ufe0f Windows <pre><code>python3 -m venv .venv\nsource .venv/bin/activate\npip install .\n</code></pre> <pre><code>python -m venv .venv\n.\\.venv\\Scripts\\activate\npip install .\n</code></pre> <p>Alternatively, follow these steps if you want to install Babylon in development mode:</p> <p>Uv</p> <pre><code>uv pip install -e . --group dev\n</code></pre> <p>Py</p> <pre><code>pip install -e .\n</code></pre> <p>Now that you have a fully functional installation of Babylon, you can check the next steps to learn how to start running commands.</p>"},{"location":"tutorial/Getting_started/#setup-babylon","title":"Setup Babylon","text":"<p>\u26a0\ufe0f Vault is replaced with Kubernetes secrets</p> <p>Babylon now uses Kubernetes secrets as the source of configuration required for it to operate</p> <p>The first thing to do to verify that Babylon is working properly run:</p> <pre><code>babylon --help\n</code></pre>"},{"location":"tutorial/Getting_started/#set-kubernetes-context","title":"Set Kubernetes Context","text":"<p>Some configuration variables must be set before interacting with the Babylon CLI.</p> <p>Currently, there are two options: 1. Babylon can load configuration directly from a Kubernetes secret. 2. You can manually export the required values as environment variables.</p> <p>Error example</p> <p><pre><code>babylon api about\n</code></pre> <pre><code>\u2192 Loading configuration from Kubernetes secret...\n\n\u2718 Resource Not Found\nSecret keycloak-babylon could not be found in namespace dev\n\n\ud83d\udca1 Troubleshooting:\n\u2022 Please ensure your kubeconfig is valid\n\u2022 Check that your context is correctly set kubectl config current-context\n\u2022 You can set context using kubectl config use-context &lt;context-name&gt;\n</code></pre></p> <p>To fix this, check your current Kubernetes context and switch to the correct one:</p> <p>Example</p> <p><pre><code>kubectl config current-context\ndev-aks\n</code></pre> <pre><code>kubectl config use-context prod-aks\nSwitched to context \"prod-aks\"\n</code></pre> <pre><code>kubectl config current-context\nprod-aks\n</code></pre></p> <p>Now you can run the command again, and it should work:</p> <p>Example</p> <p><pre><code>babylon api about\n</code></pre> <pre><code>\u2192 Loading configuration from Kubernetes secret...\n\u2192 Sending request to API...\n\u2714 API About Information: version=AboutInfoVersion(full='5.0.0-rc6-46f7c633', release='5.0.0-rc6', major=5, minor=0, patch=0, label='rc6', build='46f7c633')\n</code></pre></p> <p>Alternatively, if you need CI/CD workflows or want to run quick local tests without loading the Kubernetes secret, you can export the required variables directly in your terminal.</p> <p>Example</p> <pre><code>API_URL=https://dev.api.cosmotech.com/dev/v5   \nCLIENT_ID=cosmotech-babylon-client  \nCLIENT_SECRET=xxxxxxxxxxxxxxxxxxxxxxxxx \nTOKEN_URL=https://dev.api.cosmotech.com/keycloak/realms/dev/protocol/openid-connect/token \n</code></pre> <p>You can retrieve these values using <code>kubectl</code>, or you can contact your Babylon administrator to obtain them. Note: Make sure you have at least Contributor role assigned in Kubernetes.</p> <p>Important</p> <p>For configuration, you can retrieve the values from the cluster using one of the following methods:</p> \ud83d\udda5\ufe0f Using k9s\ud83e\udde9 Using kubectl <p>Open <code>k9s</code>, navigate to the relevant namespace, and retrieve the secret named <code>keycloak-babylon</code> which contains the configuration.</p> <pre><code># List all secrets in the target namespace\nkubectl -n dev get secrets\n\n# Look for the 'keycloak-babylon' secret and view its YAML content\nkubectl -n dev get secret keycloak-babylon -o json | jq -r '.data | to_entries[] | \"\\(.key)=\\(.value | @base64d)\"'\n</code></pre> <p>If you no longer have access to the cluster, you can export these variables manually</p> Variable Description Example <code>API_URL</code> API URL <code>https://dev.api.cosmotech.com/tenant/v5</code> <code>CLIENT_ID</code> Fixed Babylon client ID <code>cosmotech-babylon-client</code> <code>CLIENT_SECRET</code> Ask Babylon admin <code>xxxxxxxxxxx</code> <code>TOKEN_URL</code> Auth endpoint <code>https://dev.api.cosmotech.com/keycloak/realms/tenant/protocol/openid-connect/token</code> <p>Example</p> \ud83d\udda5\ufe0f Windows\ud83d\udc27 Linux <pre><code>$env:API_URL=\"https://dev.api.cosmotech.com/tenant/v5\" \n$env:CLIENT_ID=\"cosmotech-babylon-client\" \n$env:CLIENT_SECRET=\"your_secret_here\" \n$env:TOKEN_URL=\"https://dev.api.cosmotech.com/keycloak/realms/tenant/protocol/openid-connect/token\"\n</code></pre> <pre><code>export API_URL=\"https://dev.api.cosmotech.com/tenant/v5\" \nexport CLIENT_ID=\"cosmotech-babylon-client\" \nexport CLIENT_SECRET=\"your_secret_here\" \nexport TOKEN_URL=\"https://dev.api.cosmotech.com/keycloak/realms/tenant/protocol/openid-connect/token\n</code></pre>"},{"location":"tutorial/Getting_started/#configuration","title":"Configuration","text":"<p>At this point, you need three variables to perform Babylon commands.</p> Variable Description Example <code>context_id</code> Project name (string of your choice, no special characters) <code>project1</code> <code>tenant_id</code> Tenant ID (e.g., dev, staging, prod) <code>dev</code> <code>state_id</code> State name (string of your choice, no special characters) <code>state1</code> <p>\u26a0\ufe0f Variable Constraints</p> <ul> <li><code>context_id</code> and <code>state_id</code> can be any string of your choice, but they must not contain special characters.  </li> <li>For state_id, you can generate a new UUID with <code>uuidgen</code>:  </li> </ul> \ud83d\udc27 Linux\ud83d\udda5\ufe0f Windows <pre><code>sudo apt update\nsudo apt install uuid-runtime -y\n# Generate a UUID\nuuidgen | cut -c1-8\n# Example output:\n0475231d\n</code></pre> <pre><code># Open PowerShell and run:\n[guid]::NewGuid().ToString().Substring(0,8)\n# Example output:\n0475231d\n</code></pre> <ul> <li><code>tenant_id</code> represents the namespace kubernetes (e.g., <code>dev</code>, <code>staging</code>, ...).  </li> </ul> <p>To initialize Babylon namespace with these values, run:</p> <pre><code>babylon namespace use -c &lt;context_id&gt; -t &lt;tenant_id&gt; -s &lt;state_id&gt;\n</code></pre> <p>Generated Configuration</p> <ul> <li>This command creates a file called namespace.yaml</li> <li>Location: ~/.config/cosmotech/babylon/namespace.yaml</li> <li>It contains the current context for your deployment</li> </ul> <p>You can now test Babylon by running a simple command:   <pre><code>babylon api organizations list\n</code></pre> If you have already created an organization, you should see its details in the output.</p> <p>Example List Organizations</p> <p><pre><code>babylon api organizations list\n</code></pre> <pre><code>\u2192 Loading configuration from Kubernetes secret...\n\u2192 Sending request to API...\n\u2714 93 organization(s) retrieved successfully\n</code></pre></p> <p>In Babylon v5, the state is now independent of the configuration. The initial configuration is fetched from Kubernetes secrets, and the state is generated during deployment. It is then persisted in two different backends to ensure consistency and recovery.  </p> <p>This persisted state is referred to as the Babylon state.</p> <p>Where the Babylon state is stored</p> <p>The state is saved in two locations:</p> <ol> <li>Remote backend (cloud) \u2192 storage account <code>cosmotechstates</code> \u2192 containers <code>babylon-states</code></li> <li>Local backend (YAML file) \u2192 <code>~/.config/babylon/state.&lt;context_id&gt;.&lt;tenant_id&gt;.&lt;state_id&gt;.yaml</code></li> </ol>"},{"location":"tutorial/Getting_started/#state-file-specification","title":"State file specification","text":"<p>If the state file does not exist, the first Babylon command you run will initialize a new state and persist it locally.</p> <p>Note</p> <ul> <li>To enable persistence in the cloud, you must set the parameter <code>remote: true</code>.   (This will be explained in detail in the Deploy Workspace tutorial, just keep it in mind for now.)</li> <li>The structure and content of the state may change in future releases as needed.</li> </ul>"},{"location":"tutorial/Getting_started/#cloud-state-configuration","title":"Cloud State Configuration","text":"<p>When you set <code>remote: true</code> and run <code>babylon apply</code>, you might encounter an error initially.</p> <p>Error</p> <pre><code>\ud83d\ude80 Deploying Organization in namespace: sphinx\n  \u2718 Failed to initialize BlobServiceClient: Missing environment variables: 'STORAGE_NAME' and 'ACCOUNT_SECRET'\n</code></pre> <p>This is expected behavior as the cloud state requires specific environment variables to authenticate with your storage.</p> <p>To use the cloud state, you must set the following environment variables:</p> Variable Description <code>STORAGE_NAME</code> The name of your Azure Storage Account. <code>ACCOUNT_SECRET</code> Your Storage Account access key. <p>To find your ACCOUNT_SECRET, follow these steps in the Azure Portal:</p> <ol> <li>Navigate to your Storage Account.</li> <li>In the left-hand menu, go to the Security + networking section.</li> <li>Click on Access keys.</li> <li>You can use either <code>key1</code> or <code>key2</code> as your secret.</li> </ol> <p></p> <p>Security Best Practice</p> <p>Never commit your <code>ACCOUNT_SECRET</code> to a git repository. Always use environment variables or a secret manager to keep your credentials safe</p> <p>How to set them :</p> <p>Important</p> \ud83d\udda5\ufe0f Windows\ud83d\udc27 Linux <pre><code>$env:STORAGE_NAME=\"your_storage_account_name\"\n$env:ACCOUNT_SECRET=\"your_access_key\"\n</code></pre> <pre><code>export STORAGE_NAME=\"your_storage_account_name\"\nexport ACCOUNT_SECRET=\"your_access_key\"\n</code></pre>"},{"location":"tutorial/Getting_started/#babylon-state-structure","title":"Babylon State Structure","text":"<p>The Babylon state is a structured YAML file composed of multiple sections. At a high level, you will find three main entries: <pre><code>context:\nfiles: []\nid: \ntenant:\nservices:\n  api:\n    organization_id: \n    solution_id: \n    workspace_id: \n  postgres:\n    schema_name: \n  webapp:\n    webapp_name: \n    webapp_url:\n</code></pre></p>"},{"location":"tutorial/Getting_started/#whats-new-in-babylon-v5","title":"What\u2019s New in Babylon v5","text":""},{"location":"tutorial/Getting_started/#new-namespace-commands","title":"New namespace commands","text":"<p>Running the following command displays the updated namespace commands:</p> <p>Example</p> <p><pre><code>babylon namespace --help\n</code></pre> <pre><code>Usage: babylon namespace [OPTIONS] COMMAND [ARGS]...\n\n  Babylon namespace\n\nOptions:\n  --help  Show this message and exit.\n\nCommands:\n  get-contexts  Display the currently active namespace\n  get-states    Display states from local machine or remote storage.\n  use           Switch to a specific namespace or create a new one\n</code></pre></p> <p>Using these commands, you can check the currently active namespace.  Additionally, with <code>get-states</code>, you can list all states available on our local machine. Here are some examples:</p> <p>Example</p> <p><pre><code>babylon namespace get-contexts\n</code></pre> <pre><code>CURRENT  CONTEXT                            TENANT        STATE ID                              \n*        project1                           dev           1184d4e3 \n</code></pre></p>"},{"location":"tutorial/Getting_started/#viewing-state-files","title":"Viewing State Files","text":"<p>You can easily view and manage all available state files, whether they are stored locally or in the cloud. This is particularly useful when you need to select a specific state to update or redeploy your workspace.</p> <p>The <code>babylon namespace get-states</code> command provides two options:</p> <ul> <li><code>remote</code>: Lists all state files stored in the remote (cloud).</li> <li><code>local</code>: Lists all state files available on your local machine.</li> </ul> <p>Example</p> <p><pre><code>babylon namespace get-states remote\n</code></pre> <pre><code>\u2601\ufe0f  Remote States\n\u2022 state.project1.dev.d4ab0004.yaml\n\u2022 state.project2.prod.d4ab0005.yaml\n\u2022 state.project3.staging.d4ab0006.yaml\n</code></pre> <pre><code>babylon namespace get-states local\n</code></pre> <pre><code>\ud83d\udcc2  Local States\n\u2022 state.project1.dev.d4ab0004.yaml\n\u2022 state.project2.prod.d4ab0005.yaml\n\u2022 state.project3.staging.d4ab0006.yaml\n</code></pre></p>"},{"location":"tutorial/Getting_started/#keycloak-authentication","title":"Keycloak Authentication","text":"<p>Keycloak Auth</p> <ul> <li>Starting with version 5, Babylon uses Keycloak as the authentication system to authenticate with the Cosmotech API and execute commands to create objects.</li> <li>A new client, <code>cosmotech-babylon-client</code>, is created in Keycloak for this purpose.</li> </ul>"},{"location":"tutorial/Getting_started/#new-babylon-init-command","title":"New babylon init command","text":"<p>After setting the context with the <code>namespace use</code> command you can now easily initialize your project with a basic structure using the <code>babylon init</code> command. Here\u2019s an example:</p> <p>Example</p> <p><pre><code>babylon init --help\n</code></pre> <pre><code>Usage: babylon init [OPTIONS]\n\nCreate a Babylon project structure using YAML templates.\n\nOptions:\n--project-folder TEXT  Name of the project folder to create (default:'project').\n--variables-file TEXT  Name of the variables file (default:'variables.yaml').\n--help  Show this message and exit.\n</code></pre> <pre><code>babylon init\n</code></pre> <pre><code>babylon init --project-folder devops --variables-file devops.yaml \n</code></pre> <pre><code>   \u2192 Cloning Terraform WebApp module...\n   \u2714 Terraform WebApp module cloned\n   \u2192 Created directory: /home/user/CosmoTech/DevOps/babylon_v5_dir/devops\n   \u2714 Generated Organization.yaml\n   \u2714 Generated Solution.yaml\n   \u2714 Generated Workspace.yaml\n   \u2714 Generated Webapp.yaml\n   \u2714 Generated postgres/jobs/k8s_job.yaml\n   \u2714 Generated devops.yaml\n\ud83d\ude80 Project successfully initialized!\n   Path: /home/user/CosmoTech/DevOps/babylon_v5_dir/devops\n\nNext steps:\n   1. Edit your variables in devops.yaml\n   2. Run your first deployment command\n</code></pre> for structure of the generated project, you should see something like this:</p> <pre><code>.\n\u251c\u2500\u2500 babylon.log\n\u251c\u2500\u2500 devops\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Organization.yaml\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 postgres\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 jobs\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0     \u2514\u2500\u2500 k8s_job.yaml\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Solution.yaml\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 Webapp.yaml\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 Workspace.yaml\n\u251c\u2500\u2500 terraform-webapp\n\u2514\u2500\u2500 devops.yaml\n</code></pre> <p>Now, you can get started with running Babylon commands. All the required YAML files for the resources you need to deploy in v5 are provided as templates. You can customize and modify them based on your specific needs.</p>"},{"location":"tutorial/Getting_started/#new-group-for-handling-runner-and-run-objects","title":"New group for handling runner and run objects","text":"<p>Important</p> <p>There is no longer a Connector object, and Scenario / ScenarioRun have been replaced by Runner and Run. For more information refer to the Cosmo Tech platform release notes.</p>"},{"location":"tutorial/Getting_started/#meta-about-endpoint","title":"Meta About Endpoint","text":"<p>You can now see which API version you are using with the following command:</p> <p>about</p> <p><pre><code>babylon api about\n</code></pre> <pre><code>\u2192 Loading configuration from Kubernetes secret...\n\u2192 Sending request to API..\n\u2714 API About Information: version=AboutInfoVersion(full='5.0.0-rc5-897806da', release='5.0.0-rc5', major=5, minor=0, patch=0, label='rc5', build='897806da')\n</code></pre></p>"},{"location":"tutorial/Getting_started/#output-management","title":"Output Management","text":"<p>You can now handle the output of every single command. This is particularly useful for scripting, filtering data, or integration with other tools.</p> <p>You can control the output using two main flags:</p> Flag Description Supported Formats <code>-o</code> Displays the result in the terminal. <code>json</code>, <code>yaml</code>, <code>wide</code> <code>-f</code> Saves the result directly to a file. <code>json</code>, <code>yaml</code> <p>Usage Examples:</p> <p>Commands</p> <p><pre><code>babylon api organizations list -o wide\n</code></pre> <pre><code>\u2192 Loading configuration from Kubernetes secret...\n\u2192 Sending request to API...\n\u2714 94 organization(s) retrieved successfully\nID                NAME                                         CREATED         \no-zjrw54r8kxp     Debugging organization                       2025-12-10 11:21\no-x5oo38rjywq     Debugging organization                       2025-12-03 16:21\no-e2o50oxk7oe     Debugging organization                       2025-12-23 09:40\no-vd0wk30pdxx     Debugging organization                       2025-12-10 10:52\n</code></pre> <pre><code>babylon api organizations list -o json\n</code></pre> <pre><code>babylon api organizations list -o yaml\n</code></pre> <pre><code>babylon api organizations list -f organizations.json\n</code></pre> <pre><code>babylon api organizations list -f organizations.yaml\n</code></pre></p>"},{"location":"tutorial/Getting_started/#webapp-deployment","title":"Webapp Deployment","text":"<p>Webapp_deployment</p> <p>We have introduced a new macro command to handle the deployment of webapps, based on terraform modules <code>terraform-webapp</code>. This command simplifies the deployment process by automating the creation of necessary resources and configurations for web applications in specific Kubernetes clusters.</p>"},{"location":"tutorial/Getting_started/#postgresql-schema-creation","title":"PostgreSQL Schema Creation","text":"<p>Workspace_improvements</p> <p>The workspaces macro command has been significantly enhanced, especially for creating PostgreSQL schemas. These improvements streamline the setup and management of database schemas within your workspaces, making it faster and easier to define, deploy, and maintain the necessary database structures.</p>"},{"location":"tutorial/Getting_started/#commands-for-testing","title":"Commands for Testing","text":"<p>For more details on how to test, see \ud83d\udc49 Examples.</p> <p>Commands</p> <p><pre><code>babylon apply project/  \n</code></pre> <pre><code>\ud83d\ude80 Deploying Organization in namespace: dev\n  \u2192 Loading configuration from Kubernetes secret...\n  \u2192 No existing organization ID found. Creating...\n  \u2714 Organization o-xxxxxxxxx created\n\n\ud83d\ude80 Deploying Solution in namespace: dev\n  \u2192 Loading configuration from Kubernetes secret...\n  \u2192 No existing solution ID found. Creating...\n  \u2714 Solution sol-xxxxxxxxx created\n\n\ud83d\ude80 Deploying Workspace in namespace: dev\n  \u2192 Loading configuration from Kubernetes secret...\n  \u2192 No existing workspace ID found. Creating...\n  \u2714 Workspace w-xxxxxxxxx created\n  \u2192 Found PostgreSQL service postgresql\n  \u2192 Initializing PostgreSQL schema for workspace w-xxxxxxxxx...\n  \u2192 Waiting for job postgresql-init-w-xxxxxxxxx to complete...\n  \u2192 Checking job logs for errors...\n  \u2714 Schema creation w_xxxxxxxxx completed successfully\n\n\ud83d\ude80 Deploying webapp in namespace: dev\n  \u2192 Running Terraform deployment...\n  backend.tf\n  Initializing the backend...\n\n  Successfully configured the backend \"azurerm\"! Terraform will automatically\n  use this backend unless the backend configuration changes.\n\n  Apply complete! Resources: 5 added, 0 changed, 0 destroyed.\n  \u2714 WebApp business deployed\n\n\ud83d\udccb Deployment Summary\n  \u2022 Organization Id : o-xxxxxxxxx\n  \u2022 Solution Id     : sol-xxxxxxxxx\n  \u2022 Workspace Id    : w-xxxxxxxxx\n  \u2022 Webapp Name     : webapp-business\n  \u2022 Webapp Url      : https://dev.azure.platform.cosmotech.com/dev/webapp-business\n\n\u2728 Deployment process complete\n</code></pre></p> <p>Using --var-file</p> <p>You can use the <code>--var-file</code> option to specify a particular <code>variables.yaml</code> file. <pre><code>e.g. \u2192 babylon apply --var-file devops-test.yaml devops-test/\n</code></pre></p> <p>The macro command currently only covers Organization, Solution, and Workspace levels. For other resources like Runners, Datasets, etc., you must use the single commands directly to interact with the API.</p> <p>Commands</p> <p><pre><code>babylon api runners create --oid o-xxxxxxxxxx --sid sol-d-xxxxxxxxx --wid w-xxxxxxxxxxx project/runner.yaml\n</code></pre> <pre><code>babylon api datasets create --oid o-xxxxxxxxxx --wid w-xxxxxxxxxxx project/dataset.yaml\n</code></pre> <pre><code>babylon api runs list --oid o-xxxxxxxxxx --wid w-xxxxxxxxxxx --rid r-xxxxxxxxxxx\n</code></pre> <pre><code>babylon api datasets create-part --oid o-xxxxxxxxxx --wid w-xxxxxxxxxxx --did d-r-xxxxxxxxxx project/dataset_part.yaml\n</code></pre></p>"},{"location":"tutorial/API/Dataset/","title":"Dataset","text":"<p>You can include any parts you need from your CSV files, but make sure all CSV files are located in the root of the deployment directory.</p> <p>Dataset.yaml</p> <pre><code>kind: Dataset\nnamespace:\n  remote: true   # false by default\nspec:\n  sidecars:\n  payload:\n    id: # mandatory if you want to launch an update, without id a new dataset will be created ; if you want a new dataset, leave this field empty\n    name: Apply dataset\n    description: Creating dataset with nothing but update\n    tags:\n      - brewery\n    parts:\n      - name: part1\n        sourceName: customers.csv\n    security:\n      default: viewer\n      accessControlList:\n        - id: user1@email.com\n          role: admin\n        - id: user2@email.com\n          role: editor\n        - id: user3@email.com\n          role: viewer\n</code></pre>"},{"location":"tutorial/API/Organization/","title":"Organization","text":"<p><pre><code>kind: Organization\nnamespace:\n  remote: true   # false by default\n</code></pre> The deployment configuration must define the following keys:</p> <ul> <li> <p><code>kind</code>   Specifies the type of resource to deploy.   Accepted values: <code>Organization</code>, <code>Solution</code>, <code>Workspace</code>, <code>WebApp</code>.  </p> <p>\u26a0\ufe0f The resource type must always start with a capital letter.</p> </li> <li> <p><code>namespace</code>   Provides metadata that uniquely identifies the deployment, including for now just:  </p> <ul> <li><code>remote</code>   A boolean flag indicating whether the state should be stored locally only (<code>false</code>, default) or both locally and in the cloud (<code>true</code>)</li> </ul> </li> <li> <p><code>spec</code>   Defines the resource configuration. The details are specified under the <code>payload</code> section.</p> </li> </ul> <p>For example, in an Organization deployment file:</p> <p>Organization.yaml</p> <pre><code>kind: Organization\nnamespace:\n  remote: true   # false by default\nspec:\n  payload:\n    name: \"{{organization_name}}\"\n    security: {{security}}\n</code></pre> <p>All keys in this file can be templated with <code>{{}}</code> syntax for objects and <code>\"{{}}\"</code> for strings, as <code>security</code> section of this file. Corresponding values must be stored in <code>variables.yaml</code> file at the same level that your project See \ud83d\udc49 Examples:</p> <pre><code>security:\n  default: viewer\n  accessControlList:\n    - id: user1@email.com\n      role: admin\n    - id: user2@email.com\n      role: editor\n    - id: user3@email.com\n      role: viewer\n</code></pre>"},{"location":"tutorial/API/Runner/","title":"Runner","text":"<p>This is how the runner deployment file is structured</p> <p>Runner.yaml</p> <pre><code>kind: Runner\nnamespace:\n  remote: true   # false by default\nspec:\n  sidecars:\n  payload:\n    id: # mandatory if you want to launch an update, without id a new dataset will be created ; if you want a new dataset, leave this field empty\n    name: \"{{runner_name}}\"\n    runTemplateId: \"{{run_template_id}}\"\n    solutionId: \"{{services['api.solution_id']}}\"\n    solutionName: \"{{solution_name}}\"\n    runTemplateName: \"{{runTemplate_name}}\"\n    ownerName: \"{{owner_name}}\"\n    security:\n      default: viewer\n      accessControlList:\n        - id: user1@email.com\n          role: admin\n        - id: user2@email.com\n          role: editor\n        - id: user3@email.com\n          role: viewer\n</code></pre>"},{"location":"tutorial/API/Solution/","title":"Solution","text":"<p>This is how the solution deployment file is structured</p> <p>Solution.yaml</p> <pre><code>kind: Solution\nnamespace:\n  remote: true   # false by default\nmetadata:\n  selector:\n    organization_id: \"{{services['api.organization_id']}}\"\nspec:\n  payload:\n    key: \"demosolution\"\n    name: \"My Solution Name\"\n    description: \"My solution description\"\n    repository: brewery_for_continuous\n    version: latest\n    sdkVersion: '10.4.0'\n    alwaysPull: true\n    url: 'https://webapp.com'\n    tags:\n      - brewery\n    runTemplates:\n      - id: \"run_id\"\n        name: \"Standard simulation\"\n        csmSimulation: AzureWebApp/AzureWebApp_Simulation\n        run: true\n        preRun: true\n    parameters:\n    parameterGroups:\n    security:\n      default: none\n      accessControlList:\n        - id: user1@email.com\n          role: admin\n        - id: user2@email.com\n          role: editor\n        - id: user3@email.com\n          role: viewer\n</code></pre> <p>The <code>metadata</code> section defines deployment specific attributes. It is required in the following resource files:  </p> <ul> <li><code>solution.yaml</code> </li> <li><code>workspace.yaml</code> </li> </ul> <p>The <code>selector</code> block is used to specify the target organization under which the resource will be deployed.  </p> <ul> <li> <p>Parameter: <code>organization_id</code> </p> <ul> <li>Purpose:   Defines the unique organization in which the solution (or other resource) will be created.  </li> </ul> </li> <li> <p>Behavior:  </p> <ul> <li>Babylon will associate the deployment (e.g., a solution, workspace) with the specified organization_id.  </li> <li>Typically, this value is injected dynamically from the Babylon state (<code>services['api.organization_id']</code>).  </li> </ul> </li> </ul>"},{"location":"tutorial/API/Webapp/","title":"Webapp","text":"<p>To deploy a Cosmo Tech Web App now is possible with Babylon.</p> <p>Babylon now supports deploying web applications using Terraform as backend. This integration allows you to provision and manage web app infrastructure as code directly through Babylon, streamlining the deployment process.</p> <p>For more details on how to deploy the web app, refer to the README file in the Terraform web app module: \ud83d\udc49 Terraform Module.</p> <p>Babylon automatically clones the Terraform web app repository and updates the <code>terraform.tfvars</code> file with all required variables. These variables are retrieved from the <code>webapp.yaml</code> configuration file below.</p> <p>webapp.yaml</p> <pre><code>kind: Webapp\nnamespace:\n   remote: true\nspec:\n   payload:\n      cloud_provider: \"azure\"\n      cluster_name: \"{{cluster_name}}\"\n      cluster_domain: \"{{cluster_domain}}\"\n      tenant: \"{{tenant}}\"\n      webapp_name: \"{{webapp_name}}\"\n      organization_id: \"{{services['api.organization_id']}}\"\n      azure_subscription_id: \"{{azure_subscription_id}}\"\n      azure_entra_tenant_id: \"{{azure_entra_tenant_id}}\"\n      powerbi_app_deploy: false\n</code></pre>"},{"location":"tutorial/API/Workspace/","title":"Workspace","text":"<p>The Workspace configuration may include additional parameters required to provision external services.</p> <p>These parameters are normally defined under the <code>sidecars</code> section.</p> <p>One of the major changes is the replacement of the <code>ADX</code> database with <code>PostgreSQL</code> by default. Babylon now automatically creates a dedicated PostgreSQL schema for each workspace, which can be used to store runner results. As a result, the <code>sidecars</code> section now references <code>postgres</code> instead of <code>ADX</code>.</p>"},{"location":"tutorial/API/Workspace/#postgresql-schema-creation-with-kubernetes-job","title":"PostgreSQL Schema Creation with Kubernetes Job","text":"<p>With the new workspace configuration, Babylon leverages a Kubernetes job to automate the creation of a PostgreSQL schema for each workspace. This is defined under the <code>sidecars.postgres.schema.jobs</code> section:</p> <p>When <code>create</code> is set to <code>true</code>, Babylon will execute the specified Kubernetes job (<code>k8s_job.yaml</code>) located in the <code>postgres/jobs</code> directory. This job is responsible for initializing the PostgreSQL schema required by the workspace. This approach ensures that each workspace has its own isolated schema, improving data management and security.</p> <p>Workspace.yaml</p> <pre><code>kind: Workspace\nnamespace:\n  remote: true   # false by default\nspec:\n  sidecars:\n    postgres:\n      schema:\n        create: true # false by default\n        jobs:\n          - name: k8s_job.yaml\n            path: postgres/jobs\n  payload:\n    key: \"Project1\"\n    name: \"My Workspace Name\"\n    description: \"Workspace for solution\"\n    solution:\n      solutionId: \"{{services['api.solution_id']}}\"\n    useDedicatedEventHubNamespace: true\n    sendScenarioMetadataToEventHub: true\n    sendInputToDataWarehouse: true\n    sendScenarioRunToEventHub: true\n    additionalData:\n      webapp:\n        solution:\n          runTemplateFilter:\n          defaultRunTemplateDataset: null\n        charts:\n          workspaceId:\n          logInWithUserCredentials: false\n          scenarioViewIframeDisplayRatio: 4.514285714\n          dashboardsViewIframeDisplayRatio: 1.610062893\n          useWebappTheme: true\n          dashboardsView:\n          scenarioView:\n        menu:\n          supportUrl: 'https://support.cosmotech.com'\n          organizationUrl: 'https://cosmotech.com'\n          documentationUrl: 'https://portal.cosmotech.com/resources/platform-resources/web-app-user-guide'\n        datasetManager: 'removeToDisableDatasetManager'\n        datasourceFilter: []\n    security:\n      default: none\n      accessControlList:\n        - id: user1@email.com\n          role: admin\n        - id: user2@email.com\n          role: editor\n        - id: user3@email.com\n          role: viewer\n</code></pre>"}]}